<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ¯ Basic Eye Tracking Demo - Core Module</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
        }
        
        .zones-container {
            position: relative;
            height: 500px;
            border: 2px dashed #007acc;
            border-radius: 10px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }
        
        .zone {
            position: absolute;
            border: 3px solid #ddd;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
        }
        
        .zone.active {
            background: #28a745 !important;
            color: white !important;
            border-color: #1e7e34;
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(40,167,69,0.4);
        }
        
        .zone.left { left: 5%; top: 25%; width: 20%; height: 50%; }
        .zone.center { left: 40%; top: 25%; width: 20%; height: 50%; }
        .zone.right { left: 75%; top: 25%; width: 20%; height: 50%; }
        .zone.down { left: 30%; top: 80%; width: 40%; height: 15%; }
        
        .gaze-indicator {
            position: absolute;
            width: 15px;
            height: 15px;
            background: #ff0000;
            border: 3px solid white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            transform: translate(-50%, -50%);
            box-shadow: 0 3px 10px rgba(255,0,0,0.6);
            display: none;
        }
        
        .controls-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .video-container {
            width: 100%;
            height: 200px;
            border: 2px solid #28a745;
            border-radius: 10px;
            overflow: hidden;
            background: #000;
            margin-bottom: 20px;
        }
        
        .eye-tracker-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        
        .control-button {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background: #007acc;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .control-button:hover:not(:disabled) {
            background: #005a9e;
        }
        
        .control-button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .control-button.active {
            background: #28a745;
        }
        
        .status-panel {
            background: #333;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 13px;
        }
        
        .info-panel {
            background: #e7f3ff;
            border: 2px solid #007acc;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
    
    <!-- MediaPipe Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1640029074/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.6.1629159505/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1620248257/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh@0.4.1633559619/face_mesh.js" crossorigin="anonymous"></script>
    
    <!-- Core Eye Tracker Module -->
    <script src="src/CoreEyeTracker.js"></script>
</head>
<body>
    <div class="container">
        <!-- Gaze Zones Area -->
        <div class="zones-container" id="zonesContainer">
            <div class="gaze-indicator" id="gazeIndicator"></div>
            
            <div class="zone left" id="leftZone">
                <div>ðŸ‘ˆ LEFT</div>
                <small>Look left to go back</small>
            </div>
            
            <div class="zone center" id="centerZone">
                <div>ðŸŽ¯ CENTER</div>
                <small>Look center to select</small>
            </div>
            
            <div class="zone right" id="rightZone">
                <div>ðŸ‘‰ RIGHT</div>
                <small>Look right to go forward</small>
            </div>
            
            <div class="zone down" id="downZone">
                <div>ðŸ‘‡ DOWN</div>
                <small>Look down for menu</small>
            </div>
        </div>
        
        <!-- Controls Panel -->
        <div class="controls-panel">
            <h3>ðŸŽ¯ Eye Tracking Demo</h3>
            
            <div class="info-panel">
                <strong>ðŸ“– Instructions:</strong><br>
                1. Click "Start Eye Tracking"<br>
                2. Allow camera access<br>
                3. Look at different zones to test<br>
                4. Watch the red dot follow your gaze!
            </div>
            
            <!-- Camera Feed -->
            <div class="video-container">
                <video id="eyeTrackerVideo" class="eye-tracker-video" autoplay muted playsinline></video>
            </div>
            
            <!-- Controls -->
            <button id="startBtn" class="control-button">ðŸŽ¯ Start Eye Tracking</button>
            
            <!-- Status Display -->
            <div class="status-panel">
                <div><strong>Status:</strong> <span id="trackingStatus">Ready to start</span></div>
                <div><strong>Face:</strong> <span id="faceStatus">Not detected</span></div>
                <div><strong>Current Zone:</strong> <span id="currentZone">None</span></div>
                <div><strong>Gaze:</strong> <span id="gazePos">-</span></div>
                <div><strong>Confidence:</strong> <span id="confidence">-</span></div>
            </div>
        </div>
    </div>

    <script>
        class BasicDemo {
            constructor() {
                this.eyeTracker = null;
                this.isTracking = false;
                
                this.initElements();
                this.setupEventListeners();
            }
            
            initElements() {
                this.videoElement = document.getElementById('eyeTrackerVideo');
                this.startBtn = document.getElementById('startBtn');
                this.gazeIndicator = document.getElementById('gazeIndicator');
                
                // Status elements
                this.trackingStatus = document.getElementById('trackingStatus');
                this.faceStatus = document.getElementById('faceStatus');
                this.currentZone = document.getElementById('currentZone');
                this.gazePos = document.getElementById('gazePos');
                this.confidence = document.getElementById('confidence');
                
                // Zone elements
                this.zones = {
                    LEFT: document.getElementById('leftZone'),
                    CENTER: document.getElementById('centerZone'),
                    RIGHT: document.getElementById('rightZone'),
                    DOWN: document.getElementById('downZone')
                };
            }
            
            setupEventListeners() {
                this.startBtn.addEventListener('click', () => this.toggleTracking());
            }
            
            async toggleTracking() {
                if (!this.isTracking) {
                    await this.startTracking();
                } else {
                    this.stopTracking();
                }
            }
            
            async startTracking() {
                try {
                    this.trackingStatus.textContent = 'Initializing...';
                    this.startBtn.textContent = 'â³ Starting...';
                    this.startBtn.disabled = true;
                    
                    // Create eye tracker with callbacks
                    this.eyeTracker = new CoreEyeTracker({
                        sensitivity: { x: 3.5, y: 2.5 },
                        smoothing: 3,
                        debugMode: true,
                        
                        onGazeUpdate: (data) => this.handleGazeUpdate(data),
                        onZoneChange: (data) => this.handleZoneChange(data),
                        onFaceDetected: (detected, landmarkCount) => this.handleFaceDetected(detected, landmarkCount),
                        onError: (type, error) => this.handleError(type, error)
                    });
                    
                    // Initialize and start
                    const initialized = await this.eyeTracker.initialize(this.videoElement);
                    if (!initialized) throw new Error('Initialization failed');
                    
                    const started = await this.eyeTracker.start();
                    if (!started) throw new Error('Start failed');
                    
                    this.isTracking = true;
                    this.startBtn.textContent = 'â¹ï¸ Stop Eye Tracking';
                    this.startBtn.classList.add('active');
                    this.startBtn.disabled = false;
                    this.trackingStatus.textContent = 'Eye tracking active';
                    
                } catch (error) {
                    console.error('Start tracking error:', error);
                    this.trackingStatus.textContent = 'Error: ' + error.message;
                    this.startBtn.textContent = 'ðŸŽ¯ Start Eye Tracking';
                    this.startBtn.disabled = false;
                }
            }
            
            stopTracking() {
                if (this.eyeTracker) {
                    this.eyeTracker.stop();
                }
                
                this.isTracking = false;
                this.gazeIndicator.style.display = 'none';
                this.clearZoneHighlights();
                
                this.startBtn.textContent = 'ðŸŽ¯ Start Eye Tracking';
                this.startBtn.classList.remove('active');
                this.trackingStatus.textContent = 'Eye tracking stopped';
                this.faceStatus.textContent = 'Not detected';
                this.currentZone.textContent = 'None';
                this.gazePos.textContent = '-';
                this.confidence.textContent = '-';
            }
            
            handleGazeUpdate(data) {
                // Update gaze position display
                this.gazePos.textContent = `(${data.gaze.x.toFixed(3)}, ${data.gaze.y.toFixed(3)})`;
                this.confidence.textContent = data.gaze.confidence.toFixed(2);
                
                // Update gaze indicator
                this.updateGazeIndicator(data.gaze);
            }
            
            handleZoneChange(data) {
                console.log('Zone changed to:', data.zone);
                this.currentZone.textContent = data.zone;
                this.updateZoneHighlight(data.zone);
                
                // Handle zone actions
                this.handleZoneAction(data.zone);
            }
            
            handleFaceDetected(detected, landmarkCount) {
                if (detected) {
                    this.faceStatus.textContent = `Face detected (${landmarkCount} landmarks) âœ…`;
                } else {
                    this.faceStatus.textContent = 'No face detected';
                    this.gazeIndicator.style.display = 'none';
                }
            }
            
            handleError(type, error) {
                console.error('Eye tracker error:', type, error);
                this.trackingStatus.textContent = `Error: ${type}`;
            }
            
            updateGazeIndicator(gaze) {
                const containerRect = document.getElementById('zonesContainer').getBoundingClientRect();
                
                const x = containerRect.left + (gaze.x * containerRect.width);
                const y = containerRect.top + (gaze.y * containerRect.height);
                
                this.gazeIndicator.style.display = 'block';
                this.gazeIndicator.style.left = `${x}px`;
                this.gazeIndicator.style.top = `${y}px`;
            }
            
            updateZoneHighlight(zone) {
                this.clearZoneHighlights();
                
                if (this.zones[zone]) {
                    this.zones[zone].classList.add('active');
                }
            }
            
            clearZoneHighlights() {
                Object.values(this.zones).forEach(element => {
                    element.classList.remove('active');
                });
            }
            
            handleZoneAction(zone) {
                switch(zone) {
                    case 'LEFT':
                        console.log('ðŸŽ¯ Action: Go back / Previous');
                        break;
                    case 'RIGHT':
                        console.log('ðŸŽ¯ Action: Go forward / Next');
                        break;
                    case 'CENTER':
                        console.log('ðŸŽ¯ Action: Select / Activate');
                        break;
                    case 'DOWN':
                        console.log('ðŸŽ¯ Action: Show menu / Dashboard');
                        break;
                    default:
                        console.log('ðŸŽ¯ Action: Outside zones');
                }
            }
        }
        
        // Initialize demo
        const demo = new BasicDemo();
    </script>
</body>
</html>